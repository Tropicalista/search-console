var dataChart,chart,table,dataTable,token,chartQuery,chartOptions={width:"100%",height:"400",colors:["#4285f4","#00bcd4","#009688","#673ab7"],smoothline:"true",focusTarget:"category",chartArea:{width:"100%",height:"80%"},hAxis:{showTextEvery:1,format:"MMM dd"},vAxis:{gridlines:{count:0,minSpacing:100},minorGridlines:{count:2},showTextEvery:2},vAxes:{0:{direction:-1,textPosition:"none"},1:{textPosition:"none"},2:{textPosition:"none"},3:{textPosition:"none"}},series:{0:{type:"line",targetAxisIndex:1,tooltip:!0},1:{type:"line",targetAxisIndex:2,tooltip:!0},2:{type:"line",targetAxisIndex:3,tooltip:!0},3:{type:"line",targetAxisIndex:0,tooltip:!0},4:{type:"line",targetAxisIndex:0,tooltip:!0}}};function formatData(t,e){var a=new google.visualization.DataTable;return e?a.addColumn("string","Keyword"):a.addColumn("date","Keys"),a.addColumn("number","Clicks"),a.addColumn("number","Impressions"),a.addColumn("number","CTR"),a.addColumn("number","Position"),e||chartOptions.hAxis.format,_.forEach(t,function(t){a.addRow([e?t.keys[0]:dayjs(t.keys[0]).toDate(),t.clicks,t.impressions,100*t.ctr,parseFloat(t.position)])}),a}function selectHandler(){if(chart.getSelection()[0].column){var t=chart.getSelection()[0].column-1;chartOptions.series[t].tooltip=!chartOptions.series[t].tooltip,0==chartOptions.series[t].lineWidth?(chartOptions.series[t].lineWidth=2,chartOptions.series[t].areaOpacity=.3):(chartOptions.series[t].lineWidth=0,chartOptions.series[t].areaOpacity=0),chart.draw(dataChart,chartOptions)}}function start(){gapi.client.load("webmasters","v3").then(function(){gapi.auth.setToken({access_token:token}),getReport(),jQuery("#showSpinner").toggleClass("hidden")})}function getReport(){gapi.client.webmasters.searchanalytics.query(chartQuery).then(function(t){dataChart=formatData(t.result.rows),(chart=new google.visualization.LineChart(document.getElementById("gsc-chart"))).draw(dataChart,chartOptions),google.visualization.events.addListener(chart,"select",selectHandler)}).then(null,function(t){console.log(t)})}jQuery(document).ready(function(){google.charts.load("current",{packages:["corechart","table"]}),jQuery.ajax({method:"GET",url:"/wp-json/searchconsole/api/config",beforeSend:function(t){t.setRequestHeader("X-WP-Nonce",_nonce)},success:function(t){token=t.token,chartQuery={siteUrl:t.site,rowLimit:null,searchType:"web",startDate:dayjs().subtract(28,"days").format("YYYY-MM-DD"),endDate:dayjs().format("YYYY-MM-DD"),dimensions:["date"]},gapi.load("client",start)},fail:function(t){console.log(t.data.message)}})});