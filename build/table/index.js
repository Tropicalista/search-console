(()=>{"use strict";var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.date,o=window.wp.apiFetch;var n=e.n(o);const r=window.wp.element,a=window.wp.components,s=window.React;function i(e){let{onLoad:t,onError:o,...n}=e;const[r,a]=function(e){let{chartVersion:t="current",chartPackages:o=["corechart","controls"],chartLanguage:n="en",mapsApiKey:r}=e;const[a,i]=(0,s.useState)(null),[l,c]=(0,s.useState)(!1);var d,h,u;return d="https://www.gstatic.com/charts/loader.js",h=()=>{const e=null===window||void 0===window?void 0:window.google;e&&(e.charts.load(t,{packages:o,language:n,mapsApiKey:r}),e.charts.setOnLoadCallback((()=>{i(e)})))},u=()=>{c(!0)},(0,s.useEffect)((()=>{if(!document)return;const e=document.querySelector('script[src="'.concat(d,'"]'));if(null==e?void 0:e.dataset.loaded)return void(null==h||h());const t=e||document.createElement("script");e||(t.src=d);const o=()=>{t.dataset.loaded="1",null==h||h()};return t.addEventListener("load",o),u&&t.addEventListener("error",u),e||document.head.append(t),()=>{t.removeEventListener("load",o),u&&t.removeEventListener("error",u)}}),[]),[a,l]}(n);return(0,s.useEffect)((()=>{r&&t&&t(r)}),[r]),(0,s.useEffect)((()=>{a&&o&&o()}),[a]),null}const l={legend_toggle:!1,options:{},legendToggle:!1,getChartWrapper:()=>{},spreadSheetQueryParameters:{headers:1,gid:1},rootProps:{},chartWrapperParams:{}};let c=0;const d=["#3366CC","#DC3912","#FF9900","#109618","#990099","#3B3EAC","#0099C6","#DD4477","#66AA00","#B82E2E","#316395","#994499","#22AA99","#AAAA11","#6633CC","#E67300","#8B0707","#329262","#5574A6","#3B3EAC"],{Provider:h,Consumer:u}=s.createContext(l),p=e=>{let{children:t,value:o}=e;return s.createElement(h,{value:o},t)},g=e=>{let{render:t}=e;return s.createElement(u,null,(e=>t(e)))};class m extends s.Component{componentDidMount(){this.draw(this.props),window.addEventListener("resize",this.onResize),(this.props.legend_toggle||this.props.legendToggle)&&this.listenToLegendToggle()}componentWillUnmount(){const{google:e,googleChartWrapper:t}=this.props;window.removeEventListener("resize",this.onResize),e.visualization.events.removeAllListeners(t),"Timeline"===t.getChartType()&&t.getChart()&&t.getChart().clearChart()}componentDidUpdate(){this.draw(this.props)}render(){return null}constructor(...e){super(...e),this.state={hiddenColumns:[]},this.listenToLegendToggle=()=>{const{google:e,googleChartWrapper:t}=this.props;e.visualization.events.addListener(t,"select",(()=>{const e=t.getChart().getSelection(),o=t.getDataTable();if(0===e.length||e[0].row||!o)return;const n=e[0].column,r=this.getColumnID(o,n);this.state.hiddenColumns.includes(r)?this.setState((e=>({...e,hiddenColumns:[...e.hiddenColumns.filter((e=>e!==r))]}))):this.setState((e=>({...e,hiddenColumns:[...e.hiddenColumns,r]})))}))},this.applyFormatters=(e,t)=>{const{google:o}=this.props;for(let n of t)switch(n.type){case"ArrowFormat":new o.visualization.ArrowFormat(n.options).format(e,n.column);break;case"BarFormat":new o.visualization.BarFormat(n.options).format(e,n.column);break;case"ColorFormat":{const t=new o.visualization.ColorFormat(n.options),{ranges:r}=n;for(let e of r)t.addRange(...e);t.format(e,n.column);break}case"DateFormat":new o.visualization.DateFormat(n.options).format(e,n.column);break;case"NumberFormat":new o.visualization.NumberFormat(n.options).format(e,n.column);break;case"PatternFormat":new o.visualization.PatternFormat(n.options).format(e,n.column)}},this.getColumnID=(e,t)=>e.getColumnId(t)||e.getColumnLabel(t),this.draw=async e=>{let{data:t,diffdata:o,rows:n,columns:r,options:a,legend_toggle:s,legendToggle:i,chartType:l,formatters:c,spreadSheetUrl:d,spreadSheetQueryParameters:h}=e;const{google:u,googleChartWrapper:p}=this.props;let g,m=null;if(o){const e=u.visualization.arrayToDataTable(o.old),t=u.visualization.arrayToDataTable(o.new);m=u.visualization[l].prototype.computeDiff(e,t)}g=null!==t?Array.isArray(t)?u.visualization.arrayToDataTable(t):new u.visualization.DataTable(t):n&&r?u.visualization.arrayToDataTable([r,...n]):d?await async function(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(((n,r)=>{const a="".concat(o.headers?"headers=".concat(o.headers):"headers=0"),s="".concat(o.query?"&tq=".concat(encodeURIComponent(o.query)):""),i="".concat(o.gid?"&gid=".concat(o.gid):""),l="".concat(o.sheet?"&sheet=".concat(o.sheet):""),c="".concat(o.access_token?"&access_token=".concat(o.access_token):""),d="".concat(a).concat(i).concat(l).concat(s).concat(c),h="".concat(t,"/gviz/tq?").concat(d);new e.visualization.Query(h).send((e=>{e.isError()?r("Error in query:  ".concat(e.getMessage()," ").concat(e.getDetailedMessage())):n(e.getDataTable())}))}))}(u,d,h):u.visualization.arrayToDataTable([]);const w=g.getNumberOfColumns();for(let e=0;e<w;e+=1){const t=this.getColumnID(g,e);if(this.state.hiddenColumns.includes(t)){const t=g.getColumnLabel(e),o=g.getColumnId(e),n=g.getColumnType(e);g.removeColumn(e),g.addColumn({label:t,id:o,type:n})}}const v=p.getChart();"Timeline"===p.getChartType()&&v&&v.clearChart(),p.setChartType(l),p.setOptions(a||{}),p.setDataTable(g),p.draw(),null!==this.props.googleChartDashboard&&this.props.googleChartDashboard.draw(g),m&&(p.setDataTable(m),p.draw()),c&&(this.applyFormatters(g,c),p.setDataTable(g),p.draw()),!0!==i&&!0!==s||this.grayOutHiddenColumns({options:a})},this.grayOutHiddenColumns=e=>{let{options:t}=e;const{googleChartWrapper:o}=this.props,n=o.getDataTable();if(!n)return;const r=n.getNumberOfColumns();if(!1==this.state.hiddenColumns.length>0)return;const a=Array.from({length:r-1}).map(((e,o)=>{const r=this.getColumnID(n,o+1);return this.state.hiddenColumns.includes(r)?"#CCCCCC":t&&t.colors?t.colors[o]:d[o]}));o.setOptions({...t,colors:a}),o.draw()},this.onResize=()=>{const{googleChartWrapper:e}=this.props;e.draw()}}}class w extends s.Component{componentDidMount(){}componentWillUnmount(){}shouldComponentUpdate(){return!1}render(){const{google:e,googleChartWrapper:t,googleChartDashboard:o}=this.props;return s.createElement(g,{render:n=>s.createElement(m,Object.assign({},n,{google:e,googleChartWrapper:t,googleChartDashboard:o}))})}}class v extends s.Component{shouldComponentUpdate(){return!1}listenToEvents(e){let{chartEvents:t,google:o,googleChartWrapper:n}=e;if(t){o.visualization.events.removeAllListeners(n);for(let e of t){var r=this;const{eventName:t,callback:a}=e;o.visualization.events.addListener(n,t,(function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];a({chartWrapper:n,props:r.props,google:o,eventArgs:t})}))}}}render(){const{google:e,googleChartWrapper:t}=this.props;return s.createElement(g,{render:o=>(this.listenToEvents({chartEvents:o.chartEvents||null,google:e,googleChartWrapper:t}),null)})}}let f=0;class C extends s.Component{componentDidMount(){const{options:e,google:t,chartType:o,chartWrapperParams:n,toolbarItems:r,getChartEditor:a,getChartWrapper:s}=this.props,i={chartType:o,options:e,containerId:this.getGraphID(),...n},l=new t.visualization.ChartWrapper(i);l.setOptions(e||{}),s&&s(l,t);const c=new t.visualization.Dashboard(this.dashboard_ref),d=this.addControls(l,c);r&&t.visualization.drawToolbar(this.toolbar_ref.current,r);let h=null;a&&(h=new t.visualization.ChartEditor,a({chartEditor:h,chartWrapper:l,google:t})),this.setState({googleChartEditor:h,googleChartControls:d,googleChartDashboard:c,googleChartWrapper:l,isReady:!0})}componentDidUpdate(){if(!this.state.googleChartWrapper)return;if(!this.state.googleChartDashboard)return;if(!this.state.googleChartControls)return;const{controls:e}=this.props;if(e)for(let t=0;t<e.length;t+=1){const{controlType:o,options:n,controlWrapperParams:r}=e[t];r&&"state"in r&&this.state.googleChartControls[t].control.setState(r.state),this.state.googleChartControls[t].control.setOptions(n),this.state.googleChartControls[t].control.setControlType(o)}}shouldComponentUpdate(e,t){return this.state.isReady!==t.isReady||e.controls!==this.props.controls}render(){const{width:e,height:t,options:o,style:n}=this.props,r={height:t||o&&o.height,width:e||o&&o.width,...n};return this.props.render?s.createElement("div",{ref:this.dashboard_ref,style:r},s.createElement("div",{ref:this.toolbar_ref,id:"toolbar"}),this.props.render({renderChart:this.renderChart,renderControl:this.renderControl,renderToolbar:this.renderToolBar})):s.createElement("div",{ref:this.dashboard_ref,style:r},this.renderControl((e=>{let{controlProp:t}=e;return"bottom"!==t.controlPosition})),this.renderChart(),this.renderControl((e=>{let{controlProp:t}=e;return"bottom"===t.controlPosition})),this.renderToolBar())}constructor(...e){var t;super(),t=this,this.state={googleChartWrapper:null,googleChartDashboard:null,googleChartControls:null,googleChartEditor:null,isReady:!1},this.graphID=null,this.dashboard_ref=s.createRef(),this.toolbar_ref=s.createRef(),this.getGraphID=()=>{const{graphID:e,graph_id:t}=this.props;let o;return e||t?o=e&&!t?e:t&&!e?t:e:this.graphID?o=this.graphID:(c+=1,o="reactgooglegraph-".concat(c)),this.graphID=o,this.graphID},this.getControlID=(e,t)=>{let o;return f+=1,o=void 0===e?"googlechart-control-".concat(t,"-").concat(f):e,o},this.addControls=(e,t)=>{const{google:o,controls:n}=this.props,r=n?n.map(((e,t)=>{const{controlID:n,controlType:r,options:a,controlWrapperParams:s}=e,i=this.getControlID(n,t);return{controlProp:e,control:new o.visualization.ControlWrapper({containerId:i,controlType:r,options:a,...s})}})):null;if(!r)return null;t.bind(r.map((e=>{let{control:t}=e;return t})),e);for(let t of r){const{control:n,controlProp:r}=t,{controlEvents:s=[]}=r;for(let t of s){var a=this;const{callback:r,eventName:s}=t;o.visualization.events.removeListener(n,s,r),o.visualization.events.addListener(n,s,(function(){for(var t=arguments.length,s=new Array(t),i=0;i<t;i++)s[i]=arguments[i];r({chartWrapper:e,controlWrapper:n,props:a.props,google:o,eventArgs:s})}))}}return r},this.renderChart=()=>{const{width:e,height:t,options:o,style:n,className:r,rootProps:a,google:i}=this.props,l={height:t||o&&o.height,width:e||o&&o.width,...n};return s.createElement("div",Object.assign({id:this.getGraphID(),style:l,className:r},a),this.state.isReady&&null!==this.state.googleChartWrapper?s.createElement(s.Fragment,null,s.createElement(w,{googleChartWrapper:this.state.googleChartWrapper,google:i,googleChartDashboard:this.state.googleChartDashboard}),s.createElement(v,{googleChartWrapper:this.state.googleChartWrapper,google:i})):null)},this.renderControl=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>!0;return t.state.isReady&&null!==t.state.googleChartControls?s.createElement(s.Fragment,null,t.state.googleChartControls.filter((t=>{let{controlProp:o,control:n}=t;return e({control:n,controlProp:o})})).map((e=>{let{control:t,controlProp:o}=e;return s.createElement("div",{key:t.getContainerId(),id:t.getContainerId()})}))):null},this.renderToolBar=()=>this.props.toolbarItems?s.createElement("div",{ref:this.toolbar_ref}):null}}class y extends s.Component{render(){const{chartLanguage:e,chartPackages:t,chartVersion:o,mapsApiKey:n,loader:r,errorElement:a}=this.props;return s.createElement(p,{value:this.props},"ready"===this.state.loadingStatus&&null!==this.state.google?s.createElement(C,Object.assign({},this.props,{google:this.state.google})):"errored"===this.state.loadingStatus&&a?a:r,s.createElement(i,{chartLanguage:e,chartPackages:t,chartVersion:o,mapsApiKey:n,onLoad:this.onLoad,onError:this.onError}))}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}isFullyLoaded(e){const{controls:t,toolbarItems:o,getChartEditor:n}=this.props;return e&&e.visualization&&e.visualization.ChartWrapper&&e.visualization.Dashboard&&(!t||e.visualization.ChartWrapper)&&(!n||e.visualization.ChartEditor)&&(!o||e.visualization.drawToolbar)}constructor(...e){super(...e),this._isMounted=!1,this.state={loadingStatus:"loading",google:null},this.onLoad=e=>{if(this.props.onLoad&&this.props.onLoad(e),this.isFullyLoaded(e))this.onSuccess(e);else{const e=setInterval((()=>{const t=window.google;this._isMounted?t&&this.isFullyLoaded(t)&&(clearInterval(e),this.onSuccess(t)):clearInterval(e)}),1e3)}},this.onSuccess=e=>{this.setState({loadingStatus:"ready",google:e})},this.onError=()=>{this.setState({loadingStatus:"errored"})}}}var b;y.defaultProps=l,function(e){e.annotation="annotation",e.annotationText="annotationText",e.certainty="certainty",e.emphasis="emphasis",e.interval="interval",e.scope="scope",e.style="style",e.tooltip="tooltip",e.domain="domain"}(b||(b={}));const D=window.wp.i18n,E=window.wp.coreData,k=window.wp.data,T=window.wp.notices;function S(){return S=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)({}).hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},S.apply(null,arguments)}var x;!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(x||(x={}));var P="beforeunload";function L(e){e.preventDefault(),e.returnValue=""}function I(){var e=[];return{get length(){return e.length},push:function(t){return e.push(t),function(){e=e.filter((function(e){return e!==t}))}},call:function(t){e.forEach((function(e){return e&&e(t)}))}}}const _=window.wp.url,A=function(e){void 0===e&&(e={});var t=e.window,o=void 0===t?document.defaultView:t,n=o.history;function r(){var e=o.location,t=e.pathname,r=e.search,a=e.hash,s=n.state||{};return[s.idx,{pathname:t,search:r,hash:a,state:s.usr||null,key:s.key||"default"}]}var a=null;o.addEventListener("popstate",(function(){if(a)h.call(a),a=null;else{var e=x.Pop,t=r(),o=t[0],n=t[1];if(h.length){if(null!=o){var s=l-o;s&&(a={action:e,location:n,retry:function(){v(-1*s)}},v(s))}}else w(e)}}));var s=x.Pop,i=r(),l=i[0],c=i[1],d=I(),h=I();function u(e){return"string"==typeof e?e:(o=(t=e).pathname,n=void 0===o?"/":o,r=t.search,a=void 0===r?"":r,s=t.hash,i=void 0===s?"":s,a&&"?"!==a&&(n+="?"===a.charAt(0)?a:"?"+a),i&&"#"!==i&&(n+="#"===i.charAt(0)?i:"#"+i),n);var t,o,n,r,a,s,i}function p(e,t){return void 0===t&&(t=null),S({pathname:c.pathname,hash:"",search:""},"string"==typeof e?function(e){var t={};if(e){var o=e.indexOf("#");o>=0&&(t.hash=e.substr(o),e=e.substr(0,o));var n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}(e):e,{state:t,key:Math.random().toString(36).substr(2,8)})}function g(e,t){return[{usr:e.state,key:e.key,idx:t},u(e)]}function m(e,t,o){return!h.length||(h.call({action:e,location:t,retry:o}),!1)}function w(e){s=e;var t=r();l=t[0],c=t[1],d.call({action:s,location:c})}function v(e){n.go(e)}return null==l&&(l=0,n.replaceState(S({},n.state,{idx:l}),"")),{get action(){return s},get location(){return c},createHref:u,push:function e(t,r){var a=x.Push,s=p(t,r);if(m(a,s,(function(){e(t,r)}))){var i=g(s,l+1),c=i[0],d=i[1];try{n.pushState(c,"",d)}catch(e){o.location.assign(d)}w(a)}},replace:function e(t,o){var r=x.Replace,a=p(t,o);if(m(r,a,(function(){e(t,o)}))){var s=g(a,l),i=s[0],c=s[1];n.replaceState(i,"",c),w(r)}},go:v,back:function(){v(-1)},forward:function(){v(1)},listen:function(e){return d.push(e)},block:function(e){var t=h.push(e);return 1===h.length&&o.addEventListener(P,L),function(){t(),h.length||o.removeEventListener(P,L)}}}}(),z=A.push,F=A.replace;A.push=function(e,t){const o=(0,_.getQueryArgs)(window.location.href),n=(0,_.removeQueryArgs)(window.location.href,...Object.keys(o)),r=(0,_.addQueryArgs)(n,e);return z.call(A,r,t)},A.replace=function(e,t){const o=(0,_.getQueryArgs)(window.location.href),n=(0,_.removeQueryArgs)(window.location.href,...Object.keys(o)),r=(0,_.addQueryArgs)(n,e);return F.call(A,r,t)};const W=window.ReactJSXRuntime,j=((0,r.createContext)(),(0,r.createContext)()),O=(0,r.createContext)(),R=function(e){const o={customDate:!1,type:"web",startDate:(0,t.dateI18n)("Y-m-d",(new Date).setDate((new Date).getDate()-29)),endDate:(0,t.dateI18n)("Y-m-d",(new Date).setDate((new Date).getDate()-1)),dimensions:["QUERY"],fields:"rows",dimensionFilterGroups:[]},[a,s]=(0,r.useState)(!1),[i,l]=(0,r.useState)(o),[c,d]=(0,r.useState)(!1),h=(0,r.useContext)(j),[u,p]=(0,E.useEntityProp)("root","site","search_console"),{saveEditedEntityRecord:g}=(0,k.useDispatch)(E.store),{createNotice:m}=(0,k.useDispatch)(T.store),{isSaving:w,hasEdits:v}=(0,k.useSelect)((e=>({isSaving:e(E.store).isSavingEntityRecord("root","site"),hasEdits:e(E.store).hasEditsForEntityRecord("root","site",void 0,"search_console")})),[]),f=()=>{n()({path:"/searchconsole/v1/refresh",method:"POST"}).then((e=>{p({...u,token:e}),window.gapi.client.setToken(e),y()})).catch((e=>{console.log(e),m("error","⚠️ "+e.message.error_description,{type:"snackbar",explicitDismiss:!0,actions:[{label:"Reauthenticate on settings page",onClick:()=>h.push({page:"search-console-settings"})}]})}))},C=(e,t)=>{p({...u,[e]:t})};(0,r.useEffect)((()=>{const e=document.createElement("script");return e.src="https://apis.google.com/js/api.js",e.async=!0,e.defer=!0,e.onload=async()=>await window.gapi.load("client",y),document.body.appendChild(e),()=>{document.body.removeChild(e)}}),[]);const y=()=>{window.gapi.client.setToken(window.search_console.token),window.gapi.client.load("searchconsole","v1").then((()=>{b()}))},b=()=>{s(!0)};return(0,W.jsx)(O.Provider,{value:{query:i,updateQuery:(e,t)=>{l({...i,[e]:t})},settings:u,updateSetting:C,setSettings:p,saveSettings:async()=>g("root","site").then((()=>{m("info","🎯 "+(0,D.__)("Settings saved.","formello"),{type:"snackbar"})})).catch((e=>{m("error","⚠️ "+e.message,{type:"snackbar",explicitDismiss:!0})})),isSaving:w,ready:a,refreshToken:f,revokeToken:()=>{n()({path:"/searchconsole/v1/revoke",method:"POST",data:{token:u.token.refresh_token}}).then((()=>{C("token",{access_token:"",expires_in:3600,id_token:"",refresh_token:"",scope:"",token_type:""}),d(!1)}))},email:c,hasEdits:v,showError:e=>{401!==e.status&&m("error","⚠️ "+e.result.error.message,{type:"snackbar",explicitDismiss:!0}),401===e.status&&f()}},children:e.children})},B={animation:{duration:500,easing:"out",startup:!0},tooltip:{isHtml:!0,showTitle:!0},chartArea:{width:"100%"},height:350,hAxis:{gridlines:{count:5,minSpacing:15},minorGridlines:{count:0},showTextEvery:1},vAxis:{textPosition:"none"},vAxes:{},series:{0:{color:"#4285f4",labelInLegend:"Last 28 days"},1:{color:"#4285f4",lineDashStyle:[2,2],labelInLegend:"Previous 28 days"}},legend:{position:"top",alignment:"start"},focusTarget:"category"};function U({url:e}){const{settings:o}=(0,r.useContext)(O),[s,i]=(0,r.useState)(B),[l,c]=(0,r.useState)(!1),[d,h]=(0,r.useState)(),[u,p]=(0,r.useState)("clicks"),g=window.gapi,m={siteUrl:o.site,searchType:"web",startDate:(0,t.dateI18n)("Y-m-d",(new Date).setDate((new Date).getDate()-28)),endDate:(0,t.dateI18n)("Y-m-d",(new Date).setDate((new Date).getDate())),dimensions:["date"],dimensionFilterGroups:{},dataState:"all"},w=(0,r.useCallback)((()=>{if(!d)return;const e=d.current,t=d.previous,o=[];o.push([{type:"number",label:"Day"},{type:"string",role:"tooltip",p:{html:!0}},{label:"Current",type:"number"},{label:"Previous",type:"number"}]);for(const n in t.rows)n>27||o.push([parseInt(n)+1,E(n,e.rows[n].keys[0],b(e.rows[n][u]),t.rows[n].keys[0],b(t.rows[n][u])),{v:e.rows[n][u],f:b(e.rows[n][u])},{v:t.rows[n][u],f:b(t.rows[n][u])}]);c(o)}),[d,u]);(0,r.useEffect)((()=>{o.token.access_token&&C()}),[]),(0,r.useEffect)((()=>{w()}),[d,w]);const v=()=>{n()({path:"/searchconsole/v1/refresh",method:"POST"}).then((e=>{window.gapi.client.setToken(e),C()}))},f=()=>e?[{filters:[{dimension:"page",expression:e,operator:"EQUALS"}]}]:null,C=()=>{const e=g.client.newBatch();e.add(window.gapi.client.webmasters.searchanalytics.query({...m,dimensionFilterGroups:f()}),{id:"current"}),e.add(window.gapi.client.webmasters.searchanalytics.query({...m,dimensionFilterGroups:f(),startDate:(0,t.dateI18n)("Y-m-d",(new Date).setDate((new Date).getDate()-56)),endDate:(0,t.dateI18n)("Y-m-d",(new Date).setDate((new Date).getDate()-28))}),{id:"previous"}),e.then((e=>{401===e.result.current.status&&v(),h({current:e.result.current.result,previous:e.result.previous.result})})).catch((e=>{401===e.status&&v()}))},b=e=>"ctr"===u?(100*e).toFixed(2)+"%":"position"===u?e.toFixed(2):e,E=(e,t,o,n,r)=>`<div style="padding: 1rem;"><b>${(0,D.__)("Day")+" "+(parseInt(e)+1)}</b><div style="display: flex; gap: 1rem;"><span>${t}</span><b>${o}</b></div><div style="display: flex; gap: 1rem;"><span>${n}</span><b>${r}</b></div></div>`,k=(e,t)=>{p(e),i({...s,vAxis:{direction:"position"===e?-1:1,format:"ctr"===e?"#,###%":"none"},series:{0:{color:t,labelInLegend:"Last 28 days"},1:{color:t,lineDashStyle:[3,3],labelInLegend:"Previous 28 days"}}})};return l?(0,W.jsxs)("div",{className:"search-console-chart",children:[(0,W.jsxs)(a.ButtonGroup,{children:[(0,W.jsx)(a.Button,{variant:"clicks"===u?"primary":"secondary",size:"small",onClick:()=>k("clicks","#4285f4"),children:(0,D.__)("Clicks","search-console")}),(0,W.jsx)(a.Button,{variant:"impressions"===u?"primary":"secondary",size:"small",onClick:()=>k("impressions","#5e35b1"),children:(0,D.__)("Impressions","search-console")}),(0,W.jsx)(a.Button,{variant:"ctr"===u?"primary":"secondary",size:"small",onClick:()=>k("ctr","#00897b"),children:(0,D.__)("CTR","search-console")}),(0,W.jsx)(a.Button,{variant:"position"===u?"primary":"secondary",size:"small",onClick:()=>k("position","#E8710A"),children:(0,D.__)("Position","search-console")})]}),(0,W.jsx)(y,{chartType:"LineChart",data:l,options:s,chartPackages:["corechart","controls","charteditor"]})]}):(0,W.jsx)(a.Spinner,{})}const Q=()=>{const[e,t]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{const e=e=>t(e.detail.url);return window.addEventListener("search-console-details",e),()=>{window.removeEventListener("search-console-details",e)}}),[]),(0,W.jsx)(W.Fragment,{children:e&&(0,W.jsx)(a.Modal,{size:"medium",title:e,onRequestClose:()=>t(!1),children:(0,W.jsx)(U,{url:e})})})},M=()=>(0,W.jsx)(R,{children:(0,W.jsx)(Q,{})});window.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("search-console-table");(0,r.createRoot)(e).render((0,W.jsx)(M,{}))}));const G=document.getElementsByClassName("search-console column-search-console");Array.from(G).forEach((function(e){const t=e.querySelector("span.gsc-url");e.addEventListener("click",(e=>{const o=t.getAttribute("data-url"),n=new CustomEvent("search-console-details",{bubbles:!0,detail:{url:o}});window.dispatchEvent(n)}))}));let q="";const N={siteUrl:"",searchType:"web",startDate:(0,t.dateI18n)("Y-m-d",(new Date).setDate((new Date).getDate()-29)),endDate:(0,t.dateI18n)("Y-m-d",(new Date).setDate((new Date).getDate()-1)),dimensions:["page"],dimensionFilterGroups:{},startRow:0,rowLimit:1},$=[];function Y(){window.gapi.client.load("searchconsole","v1").then((()=>{window.gapi.client.setToken(q),window.gapi.client.webmasters.sitemaps.list({siteUrl:N.siteUrl}).then((function(){H()})).catch((e=>{401===e.status&&n()({path:"/searchconsole/v1/refresh",method:"POST"}).then((e=>{window.gapi.client.setToken(e),H()}))}))}))}function H(){const e=window.gapi.client.newBatch(),o=window.gapi.client.newBatch();for(const n of $){const r=[{filters:[{dimension:"page",operator:"EQUALS",expression:n}]}];e.add(window.gapi.client.webmasters.searchanalytics.query({...N,dimensionFilterGroups:r}),{id:n}),o.add(window.gapi.client.webmasters.searchanalytics.query({...N,dimensionFilterGroups:r,startDate:(0,t.dateI18n)("Y-m-d",(new Date).setDate((new Date).getDate()-57)),endDate:(0,t.dateI18n)("Y-m-d",(new Date).setDate((new Date).getDate()-30))}),{id:n})}Promise.all([e,o]).then((e=>{const t=e[0].result,o=e[1].result,n={};for(const e in t)o[e].result?.rows?.[0]&&(n[e]={current:t[e].result.rows[0],previous:o[e].result.rows[0]},$.indexOf(e)>-1&&n[e]&&window.jQuery('span[data-url="'+e+'"]').html(V(n[e])))}))}window.jQuery(document).ready((function(){window.jQuery(".gsc-url").each(((e,t)=>{$.push(window.jQuery(t).data("url"))}))})),window.onGoogleScriptLoad=()=>{n()({path:"/wp/v2/settings/"}).then((e=>{q=e.search_console.token,N.siteUrl=e.search_console.site,window.gapi.load("client",Y)}))};const V=({current:e,previous:t})=>`\n\t<b>Clicks:</b> ${e.clicks||"n/a"} (${t.clicks||"n/a"})<br />\n\t<b>Position:</b> ${Math.round(100*e.position)/100||"n/a"} (${Math.round(100*t.position)/100||"n/a"})<br />\n\t<b>CTR:</b> ${(100*e.ctr).toFixed(2)+"%"||0} (${(100*t.ctr).toFixed(2)+"%"||0})<br />\n\t<b>Impressions:</b> ${e.impressions||"n/a"} (${t.impressions||"n/a"})<br />`;!function(){const e="google-js",t=document.getElementsByTagName("script")[0];if(document.getElementById(e))return;const o=document.createElement("script");o.id=e,o.src="https://apis.google.com/js/platform.js",o.onload=window.onGoogleScriptLoad,t.parentNode.insertBefore(o,t)}()})();