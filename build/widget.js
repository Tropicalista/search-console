(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var o in r)e.o(r,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:r[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,r=window.wp.element,o=window.wp.i18n,n=window.wp.components,a=window.wp.url;function s(e){let{onLoad:r,onError:o,...n}=e;const[a,s]=function(e){let{chartVersion:r="current",chartPackages:o=["corechart","controls"],chartLanguage:n="en",mapsApiKey:a}=e;const[s,i]=(0,t.useState)(null),[l,c]=(0,t.useState)(!1);var d,h,u;return d="https://www.gstatic.com/charts/loader.js",h=()=>{const e=null===window||void 0===window?void 0:window.google;e&&(e.charts.load(r,{packages:o,language:n,mapsApiKey:a}),e.charts.setOnLoadCallback((()=>{i(e)})))},u=()=>{c(!0)},(0,t.useEffect)((()=>{if(!document)return;const e=document.querySelector('script[src="'.concat(d,'"]'));if(null==e?void 0:e.dataset.loaded)return void(null==h||h());const t=e||document.createElement("script");e||(t.src=d);const r=()=>{t.dataset.loaded="1",null==h||h()};return t.addEventListener("load",r),u&&t.addEventListener("error",u),e||document.head.append(t),()=>{t.removeEventListener("load",r),u&&t.removeEventListener("error",u)}}),[]),[s,l]}(n);return(0,t.useEffect)((()=>{a&&r&&r(a)}),[a]),(0,t.useEffect)((()=>{s&&o&&o()}),[s]),null}const i={legend_toggle:!1,options:{},legendToggle:!1,getChartWrapper:()=>{},spreadSheetQueryParameters:{headers:1,gid:1},rootProps:{},chartWrapperParams:{}};let l=0;const c=["#3366CC","#DC3912","#FF9900","#109618","#990099","#3B3EAC","#0099C6","#DD4477","#66AA00","#B82E2E","#316395","#994499","#22AA99","#AAAA11","#6633CC","#E67300","#8B0707","#329262","#5574A6","#3B3EAC"],{Provider:d,Consumer:h}=t.createContext(i),u=e=>{let{children:r,value:o}=e;return t.createElement(d,{value:o},r)},p=e=>{let{render:r}=e;return t.createElement(h,null,(e=>r(e)))};class g extends t.Component{componentDidMount(){this.draw(this.props),window.addEventListener("resize",this.onResize),(this.props.legend_toggle||this.props.legendToggle)&&this.listenToLegendToggle()}componentWillUnmount(){const{google:e,googleChartWrapper:t}=this.props;window.removeEventListener("resize",this.onResize),e.visualization.events.removeAllListeners(t),"Timeline"===t.getChartType()&&t.getChart()&&t.getChart().clearChart()}componentDidUpdate(){this.draw(this.props)}render(){return null}constructor(...e){super(...e),this.state={hiddenColumns:[]},this.listenToLegendToggle=()=>{const{google:e,googleChartWrapper:t}=this.props;e.visualization.events.addListener(t,"select",(()=>{const e=t.getChart().getSelection(),r=t.getDataTable();if(0===e.length||e[0].row||!r)return;const o=e[0].column,n=this.getColumnID(r,o);this.state.hiddenColumns.includes(n)?this.setState((e=>({...e,hiddenColumns:[...e.hiddenColumns.filter((e=>e!==n))]}))):this.setState((e=>({...e,hiddenColumns:[...e.hiddenColumns,n]})))}))},this.applyFormatters=(e,t)=>{const{google:r}=this.props;for(let o of t)switch(o.type){case"ArrowFormat":new r.visualization.ArrowFormat(o.options).format(e,o.column);break;case"BarFormat":new r.visualization.BarFormat(o.options).format(e,o.column);break;case"ColorFormat":{const t=new r.visualization.ColorFormat(o.options),{ranges:n}=o;for(let e of n)t.addRange(...e);t.format(e,o.column);break}case"DateFormat":new r.visualization.DateFormat(o.options).format(e,o.column);break;case"NumberFormat":new r.visualization.NumberFormat(o.options).format(e,o.column);break;case"PatternFormat":new r.visualization.PatternFormat(o.options).format(e,o.column)}},this.getColumnID=(e,t)=>e.getColumnId(t)||e.getColumnLabel(t),this.draw=async e=>{let{data:t,diffdata:r,rows:o,columns:n,options:a,legend_toggle:s,legendToggle:i,chartType:l,formatters:c,spreadSheetUrl:d,spreadSheetQueryParameters:h}=e;const{google:u,googleChartWrapper:p}=this.props;let g,m=null;if(r){const e=u.visualization.arrayToDataTable(r.old),t=u.visualization.arrayToDataTable(r.new);m=u.visualization[l].prototype.computeDiff(e,t)}g=null!==t?Array.isArray(t)?u.visualization.arrayToDataTable(t):new u.visualization.DataTable(t):o&&n?u.visualization.arrayToDataTable([n,...o]):d?await async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(((o,n)=>{const a="".concat(r.headers?"headers=".concat(r.headers):"headers=0"),s="".concat(r.query?"&tq=".concat(encodeURIComponent(r.query)):""),i="".concat(r.gid?"&gid=".concat(r.gid):""),l="".concat(r.sheet?"&sheet=".concat(r.sheet):""),c="".concat(r.access_token?"&access_token=".concat(r.access_token):""),d="".concat(a).concat(i).concat(l).concat(s).concat(c),h="".concat(t,"/gviz/tq?").concat(d);new e.visualization.Query(h).send((e=>{e.isError()?n("Error in query:  ".concat(e.getMessage()," ").concat(e.getDetailedMessage())):o(e.getDataTable())}))}))}(u,d,h):u.visualization.arrayToDataTable([]);const f=g.getNumberOfColumns();for(let e=0;e<f;e+=1){const t=this.getColumnID(g,e);if(this.state.hiddenColumns.includes(t)){const t=g.getColumnLabel(e),r=g.getColumnId(e),o=g.getColumnType(e);g.removeColumn(e),g.addColumn({label:t,id:r,type:o})}}const v=p.getChart();"Timeline"===p.getChartType()&&v&&v.clearChart(),p.setChartType(l),p.setOptions(a||{}),p.setDataTable(g),p.draw(),null!==this.props.googleChartDashboard&&this.props.googleChartDashboard.draw(g),m&&(p.setDataTable(m),p.draw()),c&&(this.applyFormatters(g,c),p.setDataTable(g),p.draw()),!0!==i&&!0!==s||this.grayOutHiddenColumns({options:a})},this.grayOutHiddenColumns=e=>{let{options:t}=e;const{googleChartWrapper:r}=this.props,o=r.getDataTable();if(!o)return;const n=o.getNumberOfColumns();if(!1==this.state.hiddenColumns.length>0)return;const a=Array.from({length:n-1}).map(((e,r)=>{const n=this.getColumnID(o,r+1);return this.state.hiddenColumns.includes(n)?"#CCCCCC":t&&t.colors?t.colors[r]:c[r]}));r.setOptions({...t,colors:a}),r.draw()},this.onResize=()=>{const{googleChartWrapper:e}=this.props;e.draw()}}}class m extends t.Component{componentDidMount(){}componentWillUnmount(){}shouldComponentUpdate(){return!1}render(){const{google:e,googleChartWrapper:r,googleChartDashboard:o}=this.props;return t.createElement(p,{render:n=>t.createElement(g,Object.assign({},n,{google:e,googleChartWrapper:r,googleChartDashboard:o}))})}}class f extends t.Component{shouldComponentUpdate(){return!1}listenToEvents(e){let{chartEvents:t,google:r,googleChartWrapper:o}=e;if(t){r.visualization.events.removeAllListeners(o);for(let e of t){var n=this;const{eventName:t,callback:a}=e;r.visualization.events.addListener(o,t,(function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];a({chartWrapper:o,props:n.props,google:r,eventArgs:t})}))}}}render(){const{google:e,googleChartWrapper:r}=this.props;return t.createElement(p,{render:t=>(this.listenToEvents({chartEvents:t.chartEvents||null,google:e,googleChartWrapper:r}),null)})}}let v=0;class y extends t.Component{componentDidMount(){const{options:e,google:t,chartType:r,chartWrapperParams:o,toolbarItems:n,getChartEditor:a,getChartWrapper:s}=this.props,i={chartType:r,options:e,containerId:this.getGraphID(),...o},l=new t.visualization.ChartWrapper(i);l.setOptions(e||{}),s&&s(l,t);const c=new t.visualization.Dashboard(this.dashboard_ref),d=this.addControls(l,c);n&&t.visualization.drawToolbar(this.toolbar_ref.current,n);let h=null;a&&(h=new t.visualization.ChartEditor,a({chartEditor:h,chartWrapper:l,google:t})),this.setState({googleChartEditor:h,googleChartControls:d,googleChartDashboard:c,googleChartWrapper:l,isReady:!0})}componentDidUpdate(){if(!this.state.googleChartWrapper)return;if(!this.state.googleChartDashboard)return;if(!this.state.googleChartControls)return;const{controls:e}=this.props;if(e)for(let t=0;t<e.length;t+=1){const{controlType:r,options:o,controlWrapperParams:n}=e[t];n&&"state"in n&&this.state.googleChartControls[t].control.setState(n.state),this.state.googleChartControls[t].control.setOptions(o),this.state.googleChartControls[t].control.setControlType(r)}}shouldComponentUpdate(e,t){return this.state.isReady!==t.isReady||e.controls!==this.props.controls}render(){const{width:e,height:r,options:o,style:n}=this.props,a={height:r||o&&o.height,width:e||o&&o.width,...n};return this.props.render?t.createElement("div",{ref:this.dashboard_ref,style:a},t.createElement("div",{ref:this.toolbar_ref,id:"toolbar"}),this.props.render({renderChart:this.renderChart,renderControl:this.renderControl,renderToolbar:this.renderToolBar})):t.createElement("div",{ref:this.dashboard_ref,style:a},this.renderControl((e=>{let{controlProp:t}=e;return"bottom"!==t.controlPosition})),this.renderChart(),this.renderControl((e=>{let{controlProp:t}=e;return"bottom"===t.controlPosition})),this.renderToolBar())}constructor(...e){var r;super(),r=this,this.state={googleChartWrapper:null,googleChartDashboard:null,googleChartControls:null,googleChartEditor:null,isReady:!1},this.graphID=null,this.dashboard_ref=t.createRef(),this.toolbar_ref=t.createRef(),this.getGraphID=()=>{const{graphID:e,graph_id:t}=this.props;let r;return e||t?r=e&&!t?e:t&&!e?t:e:this.graphID?r=this.graphID:(l+=1,r="reactgooglegraph-".concat(l)),this.graphID=r,this.graphID},this.getControlID=(e,t)=>{let r;return v+=1,r=void 0===e?"googlechart-control-".concat(t,"-").concat(v):e,r},this.addControls=(e,t)=>{const{google:r,controls:o}=this.props,n=o?o.map(((e,t)=>{const{controlID:o,controlType:n,options:a,controlWrapperParams:s}=e,i=this.getControlID(o,t);return{controlProp:e,control:new r.visualization.ControlWrapper({containerId:i,controlType:n,options:a,...s})}})):null;if(!n)return null;t.bind(n.map((e=>{let{control:t}=e;return t})),e);for(let t of n){const{control:o,controlProp:n}=t,{controlEvents:s=[]}=n;for(let t of s){var a=this;const{callback:n,eventName:s}=t;r.visualization.events.removeListener(o,s,n),r.visualization.events.addListener(o,s,(function(){for(var t=arguments.length,s=new Array(t),i=0;i<t;i++)s[i]=arguments[i];n({chartWrapper:e,controlWrapper:o,props:a.props,google:r,eventArgs:s})}))}}return n},this.renderChart=()=>{const{width:e,height:r,options:o,style:n,className:a,rootProps:s,google:i}=this.props,l={height:r||o&&o.height,width:e||o&&o.width,...n};return t.createElement("div",Object.assign({id:this.getGraphID(),style:l,className:a},s),this.state.isReady&&null!==this.state.googleChartWrapper?t.createElement(t.Fragment,null,t.createElement(m,{googleChartWrapper:this.state.googleChartWrapper,google:i,googleChartDashboard:this.state.googleChartDashboard}),t.createElement(f,{googleChartWrapper:this.state.googleChartWrapper,google:i})):null)},this.renderControl=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>!0;return r.state.isReady&&null!==r.state.googleChartControls?t.createElement(t.Fragment,null,r.state.googleChartControls.filter((t=>{let{controlProp:r,control:o}=t;return e({control:o,controlProp:r})})).map((e=>{let{control:r,controlProp:o}=e;return t.createElement("div",{key:r.getContainerId(),id:r.getContainerId()})}))):null},this.renderToolBar=()=>this.props.toolbarItems?t.createElement("div",{ref:this.toolbar_ref}):null}}class C extends t.Component{render(){const{chartLanguage:e,chartPackages:r,chartVersion:o,mapsApiKey:n,loader:a,errorElement:i}=this.props;return t.createElement(u,{value:this.props},"ready"===this.state.loadingStatus&&null!==this.state.google?t.createElement(y,Object.assign({},this.props,{google:this.state.google})):"errored"===this.state.loadingStatus&&i?i:a,t.createElement(s,{chartLanguage:e,chartPackages:r,chartVersion:o,mapsApiKey:n,onLoad:this.onLoad,onError:this.onError}))}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}isFullyLoaded(e){const{controls:t,toolbarItems:r,getChartEditor:o}=this.props;return e&&e.visualization&&e.visualization.ChartWrapper&&e.visualization.Dashboard&&(!t||e.visualization.ChartWrapper)&&(!o||e.visualization.ChartEditor)&&(!r||e.visualization.drawToolbar)}constructor(...e){super(...e),this._isMounted=!1,this.state={loadingStatus:"loading",google:null},this.onLoad=e=>{if(this.props.onLoad&&this.props.onLoad(e),this.isFullyLoaded(e))this.onSuccess(e);else{const e=setInterval((()=>{const t=window.google;this._isMounted?t&&this.isFullyLoaded(t)&&(clearInterval(e),this.onSuccess(t)):clearInterval(e)}),1e3)}},this.onSuccess=e=>{this.setState({loadingStatus:"ready",google:e})},this.onError=()=>{this.setState({loadingStatus:"errored"})}}}var w;C.defaultProps=i,function(e){e.annotation="annotation",e.annotationText="annotationText",e.certainty="certainty",e.emphasis="emphasis",e.interval="interval",e.scope="scope",e.style="style",e.tooltip="tooltip",e.domain="domain"}(w||(w={}));const E=window.wp.apiFetch;var D=e.n(E);const T=window.wp.date,b=window.wp.coreData,S=window.wp.data,_=window.wp.notices;function k(){return k=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},k.apply(this,arguments)}var I;!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(I||(I={}));var A="beforeunload";function P(e){e.preventDefault(),e.returnValue=""}function L(){var e=[];return{get length(){return e.length},push:function(t){return e.push(t),function(){e=e.filter((function(e){return e!==t}))}},call:function(t){e.forEach((function(e){return e&&e(t)}))}}}const F=function(e){void 0===e&&(e={});var t=e.window,r=void 0===t?document.defaultView:t,o=r.history;function n(){var e=r.location,t=e.pathname,n=e.search,a=e.hash,s=o.state||{};return[s.idx,{pathname:t,search:n,hash:a,state:s.usr||null,key:s.key||"default"}]}var a=null;r.addEventListener("popstate",(function(){if(a)h.call(a),a=null;else{var e=I.Pop,t=n(),r=t[0],o=t[1];if(h.length){if(null!=r){var s=l-r;s&&(a={action:e,location:o,retry:function(){v(-1*s)}},v(s))}}else f(e)}}));var s=I.Pop,i=n(),l=i[0],c=i[1],d=L(),h=L();function u(e){return"string"==typeof e?e:(r=(t=e).pathname,o=void 0===r?"/":r,n=t.search,a=void 0===n?"":n,s=t.hash,i=void 0===s?"":s,a&&"?"!==a&&(o+="?"===a.charAt(0)?a:"?"+a),i&&"#"!==i&&(o+="#"===i.charAt(0)?i:"#"+i),o);var t,r,o,n,a,s,i}function p(e,t){return void 0===t&&(t=null),k({pathname:c.pathname,hash:"",search:""},"string"==typeof e?function(e){var t={};if(e){var r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));var o=e.indexOf("?");o>=0&&(t.search=e.substr(o),e=e.substr(0,o)),e&&(t.pathname=e)}return t}(e):e,{state:t,key:Math.random().toString(36).substr(2,8)})}function g(e,t){return[{usr:e.state,key:e.key,idx:t},u(e)]}function m(e,t,r){return!h.length||(h.call({action:e,location:t,retry:r}),!1)}function f(e){s=e;var t=n();l=t[0],c=t[1],d.call({action:s,location:c})}function v(e){o.go(e)}return null==l&&(l=0,o.replaceState(k({},o.state,{idx:l}),"")),{get action(){return s},get location(){return c},createHref:u,push:function e(t,n){var a=I.Push,s=p(t,n);if(m(a,s,(function(){e(t,n)}))){var i=g(s,l+1),c=i[0],d=i[1];try{o.pushState(c,"",d)}catch(e){r.location.assign(d)}f(a)}},replace:function e(t,r){var n=I.Replace,a=p(t,r);if(m(n,a,(function(){e(t,r)}))){var s=g(a,l),i=s[0],c=s[1];o.replaceState(i,"",c),f(n)}},go:v,back:function(){v(-1)},forward:function(){v(1)},listen:function(e){return d.push(e)},block:function(e){var t=h.push(e);return 1===h.length&&r.addEventListener(A,P),function(){t(),h.length||r.removeEventListener(A,P)}}}}(),z=F.push,x=F.replace;F.push=function(e,t){const r=(0,a.getQueryArgs)(window.location.href),o=(0,a.removeQueryArgs)(window.location.href,...Object.keys(r)),n=(0,a.addQueryArgs)(o,e);return z.call(F,n,t)},F.replace=function(e,t){const r=(0,a.getQueryArgs)(window.location.href),o=(0,a.removeQueryArgs)(window.location.href,...Object.keys(r)),n=(0,a.addQueryArgs)(o,e);return x.call(F,n,t)},(0,r.createContext)();const R=(0,r.createContext)(),O=(0,r.createContext)(),W=function(e){const n={customDate:!1,type:"web",startDate:(0,T.dateI18n)("Y-m-d",(new Date).setDate((new Date).getDate()-29)),endDate:(0,T.dateI18n)("Y-m-d",(new Date).setDate((new Date).getDate()-1)),dimensions:["QUERY"],fields:"rows",dimensionFilterGroups:[]},[a,s]=(0,r.useState)(!1),[i,l]=(0,r.useState)(n),[c,d]=(0,r.useState)(!1),h=(0,r.useContext)(R),[u,p]=(0,b.useEntityProp)("root","site","search_console"),{saveEditedEntityRecord:g}=(0,S.useDispatch)(b.store),{createNotice:m}=(0,S.useDispatch)(_.store),{isSaving:f,hasEdits:v}=(0,S.useSelect)((e=>({isSaving:e(b.store).isSavingEntityRecord("root","site"),hasEdits:e(b.store).hasEditsForEntityRecord("root","site",void 0,"search_console")})),[]),y=()=>{D()({path:"/searchconsole/v1/refresh",method:"POST"}).then((e=>{p({...u,token:e}),window.gapi.client.setToken(e),w()})).catch((e=>{console.log(e),m("error","⚠️ "+e.message.error_description,{type:"snackbar",explicitDismiss:!0,actions:[{label:"Reauthenticate on settings page",onClick:()=>h.push({page:"search-console-settings"})}]})}))},C=(e,t)=>{p({...u,[e]:t})};(0,r.useEffect)((()=>{const e=document.createElement("script");return e.src="https://apis.google.com/js/api.js",e.async=!0,e.defer=!0,e.onload=async()=>await window.gapi.load("client",w),document.body.appendChild(e),()=>{document.body.removeChild(e)}}),[]);const w=()=>{window.gapi.client.setToken(window.search_console.token),window.gapi.client.load("searchconsole","v1").then((()=>{E()}))},E=()=>{s(!0)};return(0,t.createElement)(O.Provider,{value:{query:i,updateQuery:(e,t)=>{l({...i,[e]:t})},settings:u,updateSetting:C,setSettings:p,saveSettings:async()=>g("root","site").then((()=>{m("info","🎯 "+(0,o.__)("Settings saved.","formello"),{type:"snackbar"})})).catch((e=>{m("error","⚠️ "+e.message,{type:"snackbar",explicitDismiss:!0})})),isSaving:f,ready:a,refreshToken:y,revokeToken:()=>{D()({path:"/searchconsole/v1/revoke",method:"POST",data:{token:u.token.refresh_token}}).then((()=>{C("token",{access_token:"",expires_in:3600,id_token:"",refresh_token:"",scope:"",token_type:""}),d(!1)}))},email:c,hasEdits:v,showError:e=>{401!==e.status&&m("error","⚠️ "+e.result.error.message,{type:"snackbar",explicitDismiss:!0}),401===e.status&&y()}}},e.children)},M={animation:{duration:500,easing:"out",startup:!0},tooltip:{isHtml:!0,showTitle:!0},chartArea:{width:"100%"},height:350,hAxis:{gridlines:{count:5,minSpacing:15},minorGridlines:{count:0},showTextEvery:1},vAxis:{textPosition:"none"},vAxes:{},series:{0:{color:"#4285f4",labelInLegend:"Last 28 days"},1:{color:"#4285f4",lineDashStyle:[2,2],labelInLegend:"Previous 28 days"}},legend:{position:"top",alignment:"start"},focusTarget:"category"};function N({url:e}){const{settings:a}=(0,r.useContext)(O),[s,i]=(0,r.useState)(M),[l,c]=(0,r.useState)(!1),[d,h]=(0,r.useState)(),[u,p]=(0,r.useState)("clicks"),g=window.gapi,m={siteUrl:a.site,searchType:"web",startDate:(0,T.dateI18n)("Y-m-d",(new Date).setDate((new Date).getDate()-28)),endDate:(0,T.dateI18n)("Y-m-d",(new Date).setDate((new Date).getDate())),dimensions:["date"],dimensionFilterGroups:{},dataState:"all"},f=(0,r.useCallback)((()=>{if(!d)return;const e=d.current,t=d.previous,r=[];r.push([{type:"number",label:"Day"},{type:"string",role:"tooltip",p:{html:!0}},{label:"Current",type:"number"},{label:"Previous",type:"number"}]);for(const o in t.rows)o>27||r.push([parseInt(o)+1,b(o,e.rows[o].keys[0],E(e.rows[o][u]),t.rows[o].keys[0],E(t.rows[o][u])),{v:e.rows[o][u],f:E(e.rows[o][u])},{v:t.rows[o][u],f:E(t.rows[o][u])}]);c(r)}),[d,u]);(0,r.useEffect)((()=>{a.token.access_token&&w()}),[]),(0,r.useEffect)((()=>{f()}),[d,f]);const v=()=>{D()({path:"/searchconsole/v1/refresh",method:"POST"}).then((e=>{window.gapi.client.setToken(e),w()}))},y=()=>e?[{filters:[{dimension:"page",expression:e,operator:"EQUALS"}]}]:null,w=()=>{const e=g.client.newBatch();e.add(window.gapi.client.webmasters.searchanalytics.query({...m,dimensionFilterGroups:y()}),{id:"current"}),e.add(window.gapi.client.webmasters.searchanalytics.query({...m,dimensionFilterGroups:y(),startDate:(0,T.dateI18n)("Y-m-d",(new Date).setDate((new Date).getDate()-56)),endDate:(0,T.dateI18n)("Y-m-d",(new Date).setDate((new Date).getDate()-28))}),{id:"previous"}),e.then((e=>{401===e.result.current.status&&v(),h({current:e.result.current.result,previous:e.result.previous.result})})).catch((e=>{401===e.status&&v()}))},E=e=>"ctr"===u?(100*e).toFixed(2)+"%":"position"===u?e.toFixed(2):e,b=(e,t,r,n,a)=>`<div style="padding: 1rem;"><b>${(0,o.__)("Day")+" "+(parseInt(e)+1)}</b><div style="display: flex; gap: 1rem;"><span>${t}</span><b>${r}</b></div><div style="display: flex; gap: 1rem;"><span>${n}</span><b>${a}</b></div></div>`,S=(e,t)=>{p(e),i({...s,vAxis:{direction:"position"===e?-1:1,format:"ctr"===e?"#,###%":"none"},series:{0:{color:t,labelInLegend:"Last 28 days"},1:{color:t,lineDashStyle:[3,3],labelInLegend:"Previous 28 days"}}})};return l?(0,t.createElement)("div",{className:"search-console-chart"},(0,t.createElement)(n.ButtonGroup,null,(0,t.createElement)(n.Button,{variant:"clicks"===u?"primary":"secondary",size:"small",onClick:()=>S("clicks","#4285f4")},(0,o.__)("Clicks","search-console")),(0,t.createElement)(n.Button,{variant:"impressions"===u?"primary":"secondary",size:"small",onClick:()=>S("impressions","#5e35b1")},(0,o.__)("Impressions","search-console")),(0,t.createElement)(n.Button,{variant:"ctr"===u?"primary":"secondary",size:"small",onClick:()=>S("ctr","#00897b")},(0,o.__)("CTR","search-console")),(0,t.createElement)(n.Button,{variant:"position"===u?"primary":"secondary",size:"small",onClick:()=>S("position","#E8710A")},(0,o.__)("Position","search-console"))),(0,t.createElement)(C,{chartType:"LineChart",data:l,options:s,chartPackages:["corechart","controls","charteditor"]})):(0,t.createElement)(n.Spinner,null)}function B({text:e}){return(0,t.createElement)("div",{className:"loading-settings"},(0,t.createElement)(n.Spinner,null),(0,t.createElement)("span",{className:"description"},e))}const U={settings:!1,sites:[{label:"Select a site",value:""}],customDate:!1,dimension:"query",searchType:"web",startDate:(0,T.dateI18n)("Y-m-d",(new Date).setDate((new Date).getDate()-29)),endDate:(0,T.dateI18n)("Y-m-d",(new Date).setDate((new Date).getDate()-1)),filters:[]},Q={setSites:e=>({type:"SET_SITES",sites:e}),setSettings:e=>({type:"SET_SETTINGS",settings:e}),setSetting:(e,t)=>({type:"SET_SETTING",setting:e,value:t}),setSearchType:e=>({type:"SET_SEARCHTYPE",searchType:e}),setFilter:e=>({type:"SET_FILTER",filter:e}),setDimension:e=>({type:"SET_DIMENSION",dimension:e}),setCustomDate:e=>({type:"SET_CUSTOMDATE",val:e}),setStartDate:e=>({type:"SET_STARTDATE",date:e}),setEndDate:e=>({type:"SET_ENDDATE",date:e}),removeFilter:e=>({type:"REMOVE_FILTER",filter:e}),fetchFromAPI:e=>({type:"FETCH_FROM_API",path:e})},j=(0,S.createReduxStore)("searchconsole",{reducer(e=U,t){switch(t.type){case"SET_SETTINGS":return{...e,settings:t.settings};case"SET_SITES":return{...e,sites:t.sites};case"SET_SETTING":return{...e,settings:{...e.settings,[t.setting]:t.value}};case"SET_SEARCHTYPE":return{...e,searchType:t.searchType};case"SET_DIMENSION":return{...e,dimension:t.dimension};case"SET_CUSTOMDATE":return{...e,customDate:t.val};case"SET_STARTDATE":return{...e,startDate:t.date};case"SET_ENDDATE":return{...e,endDate:t.date};case"SET_FILTER":const r={dimension:t.filter.dimension,expression:t.filter.expression,operator:t.filter.operator},o=e.filters.filter((e=>e.dimension!==t.filter.dimension));return o.push(r),{...e,filters:o};case"REMOVE_FILTER":const n=e.filters.filter((e=>e.dimension!==t.filter.dimension));return{...e,filters:n}}return e},actions:Q,selectors:{isReady(e){var t;return null!==(t=e.settings)&&void 0!==t&&t},getSettings(e){const{settings:t}=e;return t},getSites(e){const{sites:t}=e;return t},getSite(e){const{settings:t}=e;return t.site},getQuery(e){const{searchType:t,filters:r,dimension:o,startDate:n,endDate:a}=e;return{dimension:o,startDate:n,endDate:a,searchType:t,filters:r}},getFilterByDimension:(e,t)=>e.filters.length?e.filters.find((e=>e.dimension===t)):{dimension:"",expression:"",operator:""},getSearchType(e){const{searchType:t}=e;return t},getFilters(e){const{filters:t}=e;return t},getCustomDate(e){const{customDate:t}=e;return t}},controls:{FETCH_FROM_API:e=>D()({path:e.path})},resolvers:{*getSettings(){const e=yield Q.fetchFromAPI("/searchconsole/v1/settings/");return Q.setSettings(e)}}});(0,S.register)(j);const G=()=>{const{settings:e,ready:s}=(0,r.useContext)(O);return s&&e?e?.site&&e?.credentials?.client_secret&&e?.credentials?.client_id&&e.token.refresh_token?(0,t.createElement)("div",null,(0,t.createElement)(N,null),(0,t.createElement)(r.RawHTML,null,(0,o.sprintf)(/* translators: Developer console url. */ /* translators: Developer console url. */
(0,o.__)('More data on <a href="%s">Search Console dashboard</a>.',"formello"),(0,a.addQueryArgs)("admin.php",{page:"search-console"})))):(0,t.createElement)(n.Notice,{status:"warning",isDismissible:!1},(0,t.createElement)(r.RawHTML,null,(0,o.sprintf)(/* translators: Search console settings url. */ /* translators: Search console settings url. */
(0,o.__)('<p>You need to authenticate and set a site on <a href="%s">settings page</a>.</p>',"formello"),(0,a.addQueryArgs)("admin.php",{page:"search-console-settings"})))):(0,t.createElement)(B,{text:(0,o.__)("Fetching data…","search-console")})},Y=()=>(0,t.createElement)(W,null,(0,t.createElement)(G,null));window.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("search-console-widget");(0,r.createRoot)(e).render((0,t.createElement)(Y,null))}))})();